---
layout: post   
title:  "О приведении типов в формулах"   
date:   2022-02-17   
categories: Формулы
---
# О приведении типов в формулах

Тема этого поста навеяна опросом, который предложил один из участников телеграмм-чата [CronosProChat](https://t.me/CronosProChat/4986):

![Опрос с CronosProChat](../assets/img/220217_cmp.jpg "Источник: https://t.me/CronosProChat/4986")  
*Источник: https://t.me/CronosProChat/4986*

Эксперименты, проведенные в ИСУБД CronosPro 7.0 демо,  показали, что в данной задаче ни один из предложенных вариантов сравнения не дает истину. Формула:
```
@a:="01"
@b:="001"
if (@a < @b) then [ @r(-1):="<" ]
if (@a > @b) then [ @r(-1):=">" ]
if (@a = @b) then [ @r(-1):="=" ]
@ret := valcount(@r) << @endofline << catval(@r, @endofline)
```

Выдает результат: 0

Вот так! С точки зрения Cronos эти два значения не являются равными, и при этом ни одно из них не больше другого.

Вместе с тем истинными являются выражения: `@a # @b`, `@a <= @b` и `@a >= @b`:

Формула:
```
@a:="01"
@b:="001"

if (@a # @b) then [ @r(-1):="#" ]
if (@a <= @b) then [ @r(-1):="<=" ]
if (@a >= @b) then [ @r(-1):=">=" ]

@ret:=valcount(@r)<<@endofline<<catval(@r,@endofline)
```

возвращает:
```
3
#
<=
>=
```

Возникает закономерный вопрос: как в этих условиях выполняется сортировка массива, содержащего подобные строки.

Пробуем выполнить:
```
@c(1):="000000001"
@c(2):="0001"
@c(3):="01"
@c(4):="000001"
@c(5):="001"
@c:=sort(@c)

@ret:=catval(@c,";")
```
и получаем вполне корректно выглядящий результат:
```
01;001;0001;000001;000000001
```

Итак, можно сделать предположение, что в операциях сравнения "**меньше**" и "**больше**" строки, которые могут быть приведены к числовому типу, сравниваются как числа. А в операциях "**равно**", "**неравно**", "**меньше или равно**", "**больше или равно**", а также в функции **SORT** - как строки.


**Вывод**

Безопаснее всего следить за типом данных самостоятельно и выполнять приведение типов явно:
- если нужно сравнить значения как числа, пишем `if @a+0 < @b+0 then ...`

- если как строки - `if "_" << @a < "_" << @b then ...`


А лучше - вообще избегать подобных ситуаций, например не использовать в словарях коды с лидирующими нулями (вида "001").
